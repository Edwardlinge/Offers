# 计算机部分基础

##### 																------by 在下王小丰

## 一、计算机组成原理

### 原码、反码、补码

所有的正数和负数，在计算机中，都是以补码的方式进行保存的。

|      | 原码              | 反码                                     | 补码                                  |
| ---- | ----------------- | ---------------------------------------- | ------------------------------------- |
| 正数 | 二进制码          | 本身不变                                 | 本身不变                              |
| 负数 | 最高位为1表示负号 | 原码基础上，除符号位以外，其他位全部取反 | 反码基础上加1，包括符号位全部参与计算 |

**注意：**如果在求补码过程中，有超过了定义变量类型的大小，则进行舍弃，如计算-0的补码，就舍弃了最高位1.

在计算位运算过程中，所有的数都是用补码来进行操作的。
	   补码的计算，没有符号位一说，所有的数都进行运算。
		不过在进行位运算中左移和右移动操作的时候，对于有符号的类型，会额外申请一个标志位，储存补码最高位，每次移动后都会把标志位覆盖最高位。

**tip:** 给定一个数B，则他的补码是B[补]，则 -B[补] 等于 B[补]连同符号位取反，末位加一。
              一个数B，补码再补码，仍然等于B。



## 二、操作系统

### 进程和线程

进程是系统进行资源分配和调度的基本单位；
		线程是操作系统进行运行调度的最小单位；
		线程包含在进程之中，是进程中实际运行工作的单位；
		一个进程可以并发多个线程，每个线程执行不同的任务。

对于基本单位和最小单位的理解：系统要进行一个任务，无论是几个线程，都必须至少开一个进程，开了进程才能把线程装进去，所以进程是基本单位，而进程中，是由一个或者很多个线程来组成的，所以线程是运行调度的最小单位。

同一个进程中，多个线程共享一个进程资源。

|          | 进程               | 线程                 |
| -------- | ------------------ | -------------------- |
| 资源     | 资源分配的基本单位 | 不拥有资源           |
| 调度     | 独立调度的基本单位 | 独立调度的最小单位   |
| 系统开销 | 进程系统开销大     | 线程系统开销小       |
| 通信     | 进程IPC            | 读写同一进程数据通信 |

个人理解：进程是在系统中多个并行的，多个线程在一个进程中是多个并发的。



### 死锁

**<1>定义**：
		两个或者两个以上的进程执行过程中，由于竞争资源或者由于彼此通信二造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或者系统产生了死锁，这些永远在互相等待的进程称为死锁进程。

**<2>产生**：
		共享资源数量不满足各个进程需求。
		各个进程之间发生资源调度顺序不当导致死锁。

**<3>产生死锁必要条件**：
		**互斥条件**：进程对资源的使用是排他性的使用，某资源只能由一个进程使用，其他进程需要使用只能等待。
		**请求保持条件**：进程至少保持一个资源，又提出一个新的资源请求；并且请求的新的资源被占用，请求被阻塞；而这个被阻塞的进程不释放自己保持的资源。
		**不可剥夺条件**：进程获得的资源在未完成使用前不能被剥夺，这个资源只能由进程自身释放。
		**环路等待条件**：发生死锁时，必然存在进程-资源环形链条。

**<4>死锁的处理**：
		**预防死锁的方法：**指导思想就是破坏死锁的四个必要条件中的一个或者多个，结束死锁。
				a、破坏请求保持条件：系统规定进程运行之前，一次性申请所有需要的资源，这样进程运行期间不会提出资源请求，从而摒弃请求保持条件。
				b、破坏不可剥夺条件：当一个进程请求新的资源得不到满足时，必须释放占有的资源，进程运行时占有的资源可以被释放，意味着可以被剥夺。
				c、破坏环路等待条件：可用资源线性排序，申请必须按照需要递增申请，线性申请不再形成环路，从而摒弃了环路等条件。

**<5>银行家算法**：
			客户申请的贷款是有限的，每次申请需要声明最大的资金量；
			银行家在能够满足贷款时，都应该给用户贷款；
			客户在使用贷款后，能够及时归还贷款。

​	算法需要三个表：已分配资源表，所需资源表，可分配资源表。
​			计算时候： 
​						所需资源表 - 已分配资源表 = 还需分配资源表
​						将 可分配资源表和还需分配资源表对比，优先将资源给可以执行的进程，进程结束后释放资源。

### 储存管理之内存分配

**内存分配方法**：
			单一连续分配方法：只能在单用户单进程的操作系统中使用。
			固定分区分配方法：将内存空间划分为若干固定大小区域，每个分区只提供给一个程序使用，互不干扰。
			动态分区分配方法：根据实际需要，动态分配内存空间。

### 异步任务的线程池实现

看视频【第8章 操作系统实践】，现在对线程池了解不深，看了一点，感觉理解不够深刻，后面做了项目或者遇到相对问题，再回来看，加强理解。

## 三、计算机网络

### 网络层次设计基本原则

各层之间是相互独立的
		每一层要有足够的灵活性
		各层之间是完全解耦的

### OSI七层模型

OSI : Open System Interconnect ，即为开放系统互联的缩写。

|    名称    |                 功能                 |
| :--------: | :----------------------------------: |
|   应用层   |      为计算机用户提供接口和服务      |
|   表示层   |   数据处理（编码解码，加密解密等）   |
|   会话层   |   管理（建立、维护、重连）通信会话   |
|   传输层   |         管理端到端的通信连接         |
|   网络层   | 数据路由（决定数据在网络的传输路径） |
| 数据链路层 |      管理相邻节点之间的数据通信      |
|   物理层   |        数据通信的光电物理特性        |

注：OSI最终没有成为广为使用的标准模型，现在我们使用的都是TCP/IP四层模型。

### TCP/IP四层模型

| 名称       | 实现功能                                                    | 协议                           |
| ---------- | ----------------------------------------------------------- | ------------------------------ |
| 应用层     | 实现了上面OSI中的**应用层**、**表示层**和**会话层**的功能。 | HTTP / FTP / SMTP / POP3 / ... |
| 传输层     | 实现了OSI**传输层**的功能。                                 | TCP / UDP                      |
| 网络层     | 实现了OSI中**网络层**的功能。                               | IP / ICMP                      |
| 网络接口层 | 实现了OSI中**数据链路层**和**物理层**的功能。               | Ethernet / ARP / RARP          |



### 七个网络层次介绍

#### **1>物理层**

**作用**：连接不同的物理设备，传输比特流。
		**信道**：是往一个方向传输信息的媒体，一条通信电路包含一个接收信道和发送信道。（单工、半双工、全双工通信信道）
		**分用-复用技术**：设计是为了提高物理层资源利用效率。

**网络接口层**：实现了OSI中数据链路层和物理层的功能。

#### **2>数据链路层**

**封装成帧**：将物理层传输的比特流封装成帧，加上帧首部和尾部来封装识别，帧是数据链路层传输的基本单位。
	   **透明传输**：若信息流中出现封装的帧首部或者尾部信息，会添加标记比特流来转义识别（类似转义字符）。
	   **差错检**测：负责起差错检测的工作。（奇偶校验码，循环冗余校验码CRC）
	  **注**：数据链路层的差错检测只负责检测差错，并不负责纠正，若发现错误数据，则直接丢弃。
	  **MTU**:数据链路的数据帧的最大传输单元，以太网的MTU一般为1500字节（数据帧过大过小都会影响传输效率）。
	  **路径MTU**：在传输过程中，路径中的MTU值由各个节点中，MTU最小的值决定的。

##### 		- 以太网协议详解：

**MAC地址**：
			物理地址，硬件地址。
			每个设备都拥有唯一的的MAC地址（设备的身份证）。
			MAC地址共48位，使用16进制表示，如 30-B4-9E-85-CA。
   	**以太网协议**：
			以太网（Ethernet）是一种使用广发的局域网技术。
			以太网是一种应用于**数据链路层**的协议。
			使用以太网可以完成相邻设备的数据帧传输。
			以太网协议构成（下面单位是字节）：

| 目的地址（MAC） | 原地址(MAC) | 类型 | 帧数据  | CRC  |
| :-------------: | :---------: | :--: | :-----: | :--: |
|        6        |      6      |  2   | 46~1500 |  4   |

​	**类型-数据帧**举例：

| 类型 | 数据帧              |           |
| ---- | ------------------- | --------- |
| 0800 | IP数据报            |           |
| 0806 | ARP请求/应答（28）  | PAD（16） |
| 8035 | RARP请求/应答（28） | PAD（16） |

A发送消息给C的过程，C的硬件接口已知。

![1573417683661](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573417683661.png)

C的硬件接口未知。

![1573417889620](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573417889620.png)



#### **3>网络层**

##### 		**IP协议介绍**

实际的计算机网络是错综复杂的，物理设备通过使用IP协议，屏蔽了物理网络之间的差异，当网络中的主机使用IP协议连接时，则无需关注网络细节。
		IP协议使得辅助的实际网络变为一个**虚拟互连的网络**。
		IP协议使得网络层可以屏蔽底层细节而专注网络层的数据转发。
		IP协议解决了**在虚拟网络中数据传报传输路径的问题**。

​	**IP地址**：
​				IP地址长度为32位，常分为4个8位（所以每位范围是0~255）。
​				一般由点分十进制表示（0~ 255.0~ 255.0~ 255.0~255），如：192.168.11.11
​				与MAC地址不一样，IP地址不是固定不变的，随着网络位置变化，电脑中的IP地址也发生变化。

将数据链路层中封装的帧的数据（去除帧首部和尾部），称为IP数据报。**IP数据报 = IP首部+IP数据报的数据**。
		IP协议主要研究的是IP首部。如图所示（单位：字节）。
		即主要研究前5行，每行都是32位即4字节的长度，因此IP协议至少有20个字节的长度。

![1573440507693](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573440507693.png)

​	**版本**：占4位，指的是IP协议的帮不了，通信双方版本必须一致，当前主流版本是4，即IPv4，也有我们常见的IPv6。

​	**首部长度**：占4位，最大数值为15，表示**IP首部长度**，单位是“32位字”（4个字节），也即是IP首部最大长度为**60字节**（15*4）。

​	**8位服务类型（TOS）**:略

​	**总长度**：占16位，最大数值为65535，表示的是IP数据报总长度（IP首部+IP数据）。
​				**注**：前文可以知道，数据链路层中，MTU一般为1500,远远比65535还要小，当数据报远远大于MTU时候，数据链路层将会将IP数据报进行分片传输。

​	**标识**：协议内部具体使用。

​	**标志**：标记IP报文是否可以分片。占3位，目前只有2位有意义。	

​	**片偏移**：如果进行IP报文要分片时，片偏移记录当前拆分块是原文偏移的多少位。

​	**TTL**:占8位，表明IP数据报文在网络中的寿命，经过每一个设备，TTL减1，当TTL =0 时，网络设备必须丢弃该报文。
​				作用：避免IP报文在传输过程中，找不到终点时候，无限传输下去，消耗带宽。

​	**协议**：
​				占8位，表明IP数据所携带的数据是什么协议的，如TCP、UDP等。

| 协议名 | ICMP | IGMP | IP   | TCP  | UDP  | OSPF | ...  |
| ------ | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 字段值 | 1    | 2    | 4    | 6    | 17   | 89   | ...  |

由协议可以看到，其中还有个IP协议，这表明，IP协议的数据还可以继续封装IP数据。

​	**首部校验和**：占16位，**校验IP首部**是否有出错。

​	**32位源IP地址**：发送IP数据报的机器的IP地址。

​	**32位目的IP地址**：接收IP数据报的机器的IP地址。

##### 		IP协议转发流程

**路由表简介**：
			路由表工作在网络层，工作于IP协议中。
			其内容为 **目的IP地址 + 下一跳IP地址**。
			计算机与路由器都拥有路由表，下图为MAC地址表和路由表。
![1573442617068](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573442617068.png)

**IP协议的转发流程**：
			**从网络层来理解：**			![1573442198504](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573442198504.png)

**结合数据链路层和网络层理解：**
![1573442335159](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573442335159.png)
![1573442385123](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573442385123.png)
![1573442430758](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573442430758.png)

**可以看到：数据帧每一跳的MAC地址都在变化，IP数据报每一跳的IP地址始终不变（发送和目的地址）。**

##### 		**ARP协议**

​	**介绍**：ARP(Address Resolution Protocol) 地址解析协议。
​			**作用**：将网络层的IP32位地址通过本协议，转化为数据链路层的MAC48位地址。
​			**ARP缓存表**：将IP地址和MAC地址一一对应缓存的表。这个表**是ARP协议和RARP协议运行的关键**。
​								ARP缓存表中的记录不是永久有效的，有一定期限。

​	ARP协议是封装在以太网协议中的帧数据中的，具体看以太网协议详解。

​	ARP协议占28位（字节）：

| ARP协议  | 硬件类型 | 协议类型 | 标记 | 发送端以太网地址 | 发送端IP地址 | 目的端以太网地址 | 目的端IP地址 |
| -------- | -------- | -------- | ---- | ---------------- | ------------ | ---------------- | ------------ |
| 占用大小 | 2        | 2        | 4    | 6                | 4            | 6                | 4            |

##### 		**RARP协议**

​	介绍：RARP(Reverse Address Resolution Protocol) 逆地址接卸协议。

​	作用：ARP反向操作。

##### 		**IP地址的子网划分**

###### 	**IP地址的分类**

32位的IP地址由网络号和主机号构成。而不同长度的网络号和主机号位不同类别的地址。

|                      | 网络号长度 | 主机号长度 |
| :------------------: | :--------: | :--------: |
|  A类地址（以0开头）  |     8      |     24     |
| B类地址（以10开头）  |     16     |     16     |
| C类地址（以110开头） |     24     |     8      |

由此可以得到三类地址特性：

|      |  最小网络号   | 最大网络号      | 子网数量 | 最小主机号 | 最大主机号  | 主机数量 |
| :--: | :-----------: | --------------- | :------: | :--------: | :---------: | :------: |
| A类  | 0（00000000） | 127（01111111） |   2^7    |   0.0.1    | 255.255.254 |   2^24   |
| B类  |     128.0     | 192.255         |   2^14   |    0.1     |   255.254   |   2^16   |
| C类  |    192.0.0    | 255.255.255     |   2^21   |     1      |     254     |   2^8    |

###### 	**特殊的主机号**

​		主机号全为0表示当前网络断，不可以分配为待定主机。如1.0.0.0

​		主机号全为1表示广播地址，向当前网络端所有主机发消息。如1.255.255.255。（二进制下255全为1）

###### 	**特殊的网络号**

​		A类地址网络段全为0的，表示特殊网络。

​		A类地址网络段后七位全为1（011111111：127）表示回环地址。

​		B类地址网络段（10000000.00000000:128.0）是不可使用的。

​		C类地址网络段（192.0.0）是不可使用的。

​	因此，更精确的表格为：

|      | 最小网络号 | 最大网络号      | 子网数量 | 最小主机号 | 最大主机号  | 主机数量 |
| :--: | :--------: | --------------- | :------: | :--------: | :---------: | :------: |
| A类  |     1      | 127（01111111） |  2^7-2   |   0.0.0    | 255.255.255 |  2^24-2  |
| B类  |   128.1    | 192.255         |  2^14-1  |    0.0     |   255.255   |  2^16-2  |
| C类  |  192.0.1   | 223.255.255     |  2^21-1  |     0      |     255     |  2^8-2   |

**注**：127.0.0.1，通常被称为本地回环地址（Loopback Address），不属于任何一个有类别地址类（即不属于ABC中任意一类）。它代表设备的本地虚拟接口，所以默认被看作是永远不会宕掉的接口。在Windows操作系统中也有相似的定义，所以通常在安装网卡前就可以ping通过这个本地回环地址。一般都会用来检测本地网络协议，基本数据接口是否正常。

###### 划分子网

将IP地址再细分，分为 网络号+子网号+主机号

如B类地址，将最后8位划分为 .00000000 和.10000000，那么就可以得到两段可用地址区间。

例：193.10.10.0 划分后，得到193.10.10.0~193.10.10.127 和193.10.10.128~193.10.10.255

###### 子网掩码

作用：子网号过多，通过子网掩码快速判断某个IP的网络号。
		子网掩码和IP地址一样，都是32位。
		子网掩码由连续的1和连续的0组成。
		某个子网的子网掩码具备网络号位数个数连续的1（即包括网络号，子网号全部置为1，后面置为0）。
		如：193.10.10.7，C类地址，子网划分为最后8位中的第一位，因此子网掩码为：255.255.255.128。（128=10000000：子网号和主机号）

例子：
		A类地址子网掩码：255.0.0.0（网络号全为1，主机号全为0）
		B类地址子网掩码：255.255.0.0
		C类地址子网掩码：255.255.255.0

计算某个地址所在的网络号：将该地址和该地址的子网掩码用二进制表示，然后进行与运算，最后即可得到其所属的网络号。

例：地址 193.10.10.129 ， 他的子网掩码 255.255.255.128
		二进制表示地址：11000001.00001010.00001010.10000001
		二进制表示掩码：11111111.11111111.11111111.10000000
		与运算后得到：11000001.00001010.00001010.10000000
		即可得到其所属IP地址：193.10.10.128

###### **无分类编址CID**R

CIDR中没有A、B、C类网络号和子网划分的概念。

CIDR将网络前缀相同的IP地址称为一个“CIDR地址块”。

即：CIDR = 网络前缀 + 主机号。

可见网络前缀是任意位数长度的，通常用斜线来标记划分网络前缀和主机号。
		例：193.10.10.129 / 25 即为前面这个地址前面25位都是网络前缀，后面是主机号。
![1573462471653](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573462471653.png)

因为CIDR划分比前面的子网划分更加灵活，现在我们用的大多已经是CIDR划分方法。

##### 网络地址转化NAT技术

NAT：Network Addresss Translation

NAT技术用于多个主机通过一个共有IP访问互联网的私有网络中。

![1573464056859](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573464056859.png)

NAT技术减缓了IP地址的消耗，但是增加了网络通信的复杂度。

**内网地址与外网地址**：

​	内网地址供内部机构使用，避免与外网地址重复，但是不同局域网下，内网地址可以相同。
​			外网地址全球范围内使用，全球公网唯一。

​	内网地址：
​			A类：10.0.0.0~10.255.255.255		支持千万数量级设备
​			B类：172.16.0.0~172.31.255.255	支持百万数量级设备
​			C类：192.168.0.0~192.168.255.555 支持万数量级设备

##### **ICMP协议**

介绍：ICMP(Internet Control Message Protocol) 国际控制报文协议。

作用：可以报告错误信息或者异常情况。（对IP协议的辅助）

位置：封装在IP数据报文中进行传输的，如图：

![1573465164277](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573465164277.png)

构成：ICMP = 8 位类型 + 8位代码 + 16位校验和 + ICMP报文数据

![1573465444558](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573465444558.png)

![1573465539036](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573465539036.png)

###### ICMP应用

​	Ping应用：使用的是询问报文。

​	Traceroute应用：可以探测IP数据报在网络中走过的路径，巧妙利用了TTL和ICMP终点不可达报文实现。

##### 网络层的路由概述

路由表 = 目的IP地址 + 下一跳IP地址



#### **4>传输层**

**端口**：使用端口来标记不同的网络进程。
		端口使用16比特位来表示（0~65535）
		常见端口号：

| FTP  | HTTP | HTTPS | DNS  | TELNET |
| :--: | :--: | :---: | :--: | :----: |
|  21  |  80  |  443  |  53  |   23   |

##### UDP协议

 全称：UDP(User Datagram Protocol) 用户数据报协议

UDP是一个非常简单的协议。

UDP协议不会对数据做任何处理，传输过来多少，就接收多少，传输多少。

![1573478297426](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573478297426.png)

UDP构造：

![1573478351372](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573478351372.png)

UDP协议特点：
			UDP是无连接的协议，即不用特意在两个机器之间建立连接。
			UDP不能保证可靠的交付数据，想发就发，无法保证数据在网络传输中是否有丢失。
			UDP是面向报文进行传输的。
			UDP没有**拥塞控制**。
			UDP首部开销很小。

##### TCP协议

全称：TCP(Transmission Control Protocol) 传输控制协议。

TCP是计算机网络中非常复杂的一个协议。

![1573479349579](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573479349579.png)

###### **TCP特点**

​	TCP是**面向连接**的协议。
​			TCP的连接有**两端**（点对点通信）。
​			TCP提供**可靠的**传输服务。
​			TCP协议提供**全双工**的通信。
​			TCP是面向**字节流**的协议。

###### **TCP首部介绍**

![1573479580714](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573479580714.png)

​	**序号**：32位，范围0~2^32 -1。因为TCP是面向字节流的，所以一个字节一个序号，数据首字节序号。
​			**确认号**：32位，范围0~2^32 - 1。一个字节一个序号。表达期望收到数据的首字节序号。如果确认号为N，则表示N-1序号的数据都已经收到了。
​			**数据偏移**：4位，0~15，单位是32字（4个字节）。表达数据偏离首部的距离。由此可见TCP首部有20 ~ 60（4*15最大偏移）个字节。
​			**TCP标记**：占6位，每位都有不同意义。 ![1573480626944](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573480626944.png)

​		**窗口**：占16位，0~2 ~16 -1。窗口指明允许对方发送的数据量。
​				**校验和**：略
​				**紧急指针**:URG =1时候启用，指定紧急数据在报文的位置。
​				**TCP选项**：最多40个字节，支持未来拓展。

###### 	**TCP的可靠传输**

**基本原理**：

​	**停止等待协议**：
​				消息在发送方发送给接收方时候，接收方会停止等待消息，当消息到达后，需要发送确认收到信息，此时发送方处于停止发送消息状态，直到等待收到接收方返回的确认消息后，才再次发送第二条消息。
​				**超时重传**：当发送方在规定时间内没有收到确认消息，就会重新发送一次消息给接收方。同理，接收方在规定时间内没有收到第二条消息或者隔了超过规定时间才收到确认消息，接收方会重新发送一次第一条收到消息的确认消息给发送方。
​				**超时定时器**：由超时重传设定的，每次发送一条消息，都需要设置一个定时器。
​				**停止等待协议优缺点**：这个协议是最简单的可靠传输协议，但是它对信道的利用效率不高。

​	**连续ARQ协议**：
​				**ARQ** ：Automatic Repeat reQuest 自动重传请求。是停止等待协议的优化。
​				滑动窗口：同时发送一个窗口长度的消息，当收到确认消息后滑动窗口发送后面的消息。
​				累计确认：不是一条一条的接收确认消息后滑动窗口，而是统计接收的消息数，然后滑动窗口。

![1573481817389](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573481817389.png)

​	**可靠传输**：

​		TCP的可靠传输是基于连续ARP协议的。
​				TCP的滑动窗口以字节为单位。

​		**选择重传**：
​					当滑窗中收到确认的消息不是连续的，那就需要对未收到确认的消息进行选择重传，而未收到的消息就记录在TCP首部中的TCP选项中，一般记录的是一段未收到确认消息的区间。

###### **TCP协议的流量控制**

流量控制指让发送方发送速率不要太快。
		流量控制是使用滑动窗口来实现的。

![1573484411478](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573484411478.png)

**传输过程中数据丢失情况**：

​		接收方上一次返回窗口大为0，需要发送方等待，当接收方处理完消息后，返回窗口个大小给发送方让发送方发送消息，但是过程中数据丢失，这样的情况会出现两方相互等待情况，出现死锁。此时需要坚持定时器。

​		**坚持定时器**：当接受到窗口为0的消息时，启动坚持定时器，坚持定时器会每隔一段时间发送一个窗口探测报文。

###### 	**TCP协议的拥塞控制**

​	**可能触发拥塞的条件**：一条数据链路经过非常多的设备。数据链路中各个部分都有可能成为网络传输的瓶颈。
​			**判断拥塞**：当提交的报文超时时，则认为出现了拥塞。

​	拥塞控制和流量控制区别：
​				流量控制考虑点对点的通信的控制。
​				拥塞控制考虑整个网络，是全局性的考虑。

​	**慢启动算法**：有小到大逐渐增加发送数据量。每收到一个报文确认，就在原来基础上增加一倍的发送量（指数增长）。
​			**慢启动阈值**：设置阈值，当一次发送的数据量达到某个阈值，则不再增加数据量。换用下面的拥塞避免算法。

​	**拥塞避免算法**：维护一个拥塞窗口的变量，拥塞窗口的最初大小就是慢启动阈值的大小。
​									只要网络不拥塞，就试着拥塞窗口调大，若发生拥塞就减小窗口。

######   **TCP连接的建立-三次握手**

回顾TCP首部的标记位：

![1573485402719](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573485402719.png)

三次握手示意图：

​	**第一次握手**：发送方发送信息，包括SYN =1  请求连接，并发送消息位x。
​			**第二次握手**：接收方接收到信息以后，回应发送方消息，包括SYN =1 请求连接，ACK =1 确认接收到信息，发送消息位y，下次期望消息位x+1。
​			**第三次握手**：发送方收到确认消息以后，建立了连接，发送消息给接收方，包括ACK = 1确认收到反馈，发送消息位x+1，并说明下次期待消息位 y+1。
​			如下：

![1573485772894](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573485772894.png)

为什么发送方要发出第三个确认报文呢？

避免已经失效的连接请求报文传送到对方，引起错误。

**感性理解**：我和我对象隔得太远（哈哈哈哈，可是我没对象啊，强行有个对象吧），我们要相互写信给对方，但是邮局系统他不稳定啊，我不知道我们到底有没有通信成功啊，所以我们要经过几次沟通才能确认相互通信成功了。
		首先，我得先写第一封信给我对象，并且我要告诉对象这是要写她的信（SYN=1）,并且这是我写出去的第一封信（seq = 1）。【第一次握手】
		然后，我对象收到信件了，她得回复我，这样我才能知道我写给她的信她收到，我才能确定这一次通信，从我到她那的邮局系统是稳定的，那我怎么确定她回复的是这一次通信的信而不是回复的是很久之前的信呢，她这一次就回复我她收到了信（ACK=1）,并且要和我写信（SYN=1）,这是她这次写给我的第一封信（seq = y），她也想我了，想收到我的第二封信（ack=x+1）。【第二次握手】
		最后，我收到了她的信，让我知道了从我发出到她那的信息通道是通过的，那我得给她回个信，告诉她我收到了呀，然后她也知道了从她那发给我的信的信道是通过的呀，所以我就给她发送消息了，你的信我收到啦（ACK=1），如你所愿，我写第二封信给你啦（seq=x+1），当然，我也想收到你的第二封信（ack=y+1）。这样，她收到我的信以后，就能确定，她到我这的通信也成功了，我发给她的也能成功了，然后就能快乐地相互通信了。【第三次握手】
		这样，以后我们只需要告诉对方我们收到信息了【ACK=1]，并且这是我第几次写信给你了【seq=n+1】,希望收到你第几次的信【ack=m+1】。

试想，如果只用两次握手就能建立连接，假如我第一次写信过去，我这边很久都没有收到对象回复的消息因为邮局给我记错了，正在重新寄过去我对象那里（网络拥塞），我就会重新写一封信给对象（重发消息）。重发的这条消息由于邮局没搞错，发给对象了，对象看到了，就觉得邮局没问题，我们正常通话了，就回复我了，这时候我收到消息了，诶，那就正常通话了，我们就正常建立好通信了。这次我们通话不多，很快就结束了，我进入了关闭状态，对象也进入关闭状态了。突然那封拥塞的消息寄到我对象那里去了，我对象以为我又要建立通信，于是同意了，进入了连接状态，并且回复我了，但是我已经进入了关闭状态，没有响应，这样我对象一直等啊等，就浪费了他的时间（资源浪费），我还有可能凉了。

###### **TCP连接的释放-四次挥手**

**第一次挥手**：发送方发送终止传输的消息，FIN = 1终止，并发送消息位u。
		**第二次挥手**：接收方接收到消息后表示知道了，返回确认消息并发送消息位v和期望接收位u+1。
		中途可能接收方还没有处理完接收到的消息，此时需要等待接收方处理完。
		**第三次挥手**：接收方处理完信息表示可以终止了，就发送终止传输消息给发送方，并再次确认收到第一次挥手消息，并发送消息位w，和期待收到消息u+1。
		**第四次挥手**：发送方收到接收方的终止请求后做出反馈，确认收到消息，并发出消息u+1，和期望收到信息w+1。

最后，接收方收到反馈后就直接进入关闭状态，而发送方需要在等待计时器计时结束后才能进入关闭状态。

![1573488684722](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573488684722.png)

**等待计时器**：等待时间为 2MSL。
		MSL ：Max Segment Lifetime  最长报文段寿命，一般建议设置为2分钟。

需要等待计时器的原因：
				因为最后一次挥手没有得到回馈确认，需要确保发送方的ACK可以成功到达接收方。如果2MSL时间内接收方没有接接收到第四次挥手信息，接收方会重新发送第三次挥手，让发送方再次执行第四次挥手。
				确保当前连接的所有报文都已经过期（时间设置为2MSL的原因）。

**感性理解：**我和对象写信写了很久了，突然组织上要派我去其他地方工作，写不了信了，我得告诉我对象我的情况，结束这一段时间的交流了。
		首先，我要告诉他，这次通信就到这吧（FIN =1），这是我写给你的第u封信了（seq=u）。【第一次挥手】
		然后，对象收到以后，她也很懂事，不无理取闹，就回复我了，我收到你的信啦（ACK=1）,这是我写给你的第v封信了（seq=v）,不过我这边还有点事要处理，咱们先别急着停止通信，我处理完了告诉你，我们再停止，到时候希望你能告诉我你收到我停止的信（ack=u+1）。【第二次 挥手】
		中间，我对象要处理完这次信件中我们聊的事，处理完以后，对象就给我写信，这是上次说停止写信的时候说的信（ACK=1），我也能结束啦（FIN=1），这是我写的第w封信了，对了，记得要告诉我你也知道我结束咯（ack=u+1）。【第三次挥手】
		最后，我收到了对象的信，也就放心了，知道她也能结束了，就给他回信，收到（ACK=1），这是你期待的信（ack=u+1）,
如果你有什么特殊事情，可以写下一封信给我（ack=w+1）。对象就收到我的信以后，表示，嗯，他收到了，那就哦了，然后就停止写信了，进入了关闭状态。【第四次挥手】
		当然，事情没有结束，我是一个负责人的人啊，我不能马上关闭走人啊，我得等一下，保证我的信一定寄过去了，如果她没收到我的回复，她还会再发给我一次确认结束的（重新发送第三次挥手给我）。这一来一回最久就是2个MSL，总的来说等了2MSL，这时候，没有收到消息，表明她那边已经收到消息，保证关闭了，那我也能够安心关闭了。我才进入了关闭状态。

###### **套接字与套接字编程**

使用端口（Port）；奥标记不同的网络进程，端口使用16比特位表示（0~65535）。
		套接字：IP和端口的组合 {IP : Port}

套接字（Socket）是抽象概念，表示TCP连接的一端。
		通过套接字可以进行数据发送或者接收。

TCP连接由两个套接字组成：
		TCP = {Socket1 ： Socket2} = { { IP1 : Port }  { IP2: Port } }

#### 5>应用层

传输层及以下的层已经为应用层提供了完整的通信服务，应用层是面向用户的一层。

应用层主要是要**定义应用间的通信规则**，如：
			应用进程的报文类型（请求报文，应答报文）
			报文的语法，格式
			应用进程发送数据的时机、规则。

一些已有的应用层协议：

| FTP  | HTTP | HTTPS | DNS  | TELNET |
| ---- | ---- | ----- | ---- | ------ |
| 21   | 80   | 443   | 53   | 23     |

回顾传输层的两个协议，他们的应用领域和特点：

![1573491203112](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573491203112.png)

##### **DNS**

DNS: Domain Name System 域名系统
		Domain域：网络段，AS自治域
		Name名：某个IP对应的名字

使用域名帮助记忆： 域名→DNS服务→IP地址（如域名：www.baidu.com）

**域名**由点、字母和数字组成，其中字母不分大小写。点分割不同的域。
		域名可以分为顶级域、二级域、三级域。如com，百度， www分别是顶级域，二级域，三级域。

顶级域：
![1573491727973](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573491727973.png)

二级域：如qq，baidu，amazon，baidu， google， facebook，alibaba。

一个二级域可以对应多个多级域：
![1573491851474](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573491851474.png)

DNS服务器结构：
![1573491989405](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573491989405.png)



##### **DHCP协议**

DHCP: Dynamic Host Configuration Protocol 动态主机设置协议

DHCP是一个局域网协议

DHCP是应用UDP协议的应用层协议

##### **HTTP协议**

HTTP：Hyper Text Transfer Protocol 超文本传输协议

 标准：http(s)://<主机>：<端口> / <路径>     常用端口：80/8080/3128/8081/9098

HTTP协议是可靠的数据传输协议（底层是由TCP协议实现的）

客户端   ————HTTP 协议——————→  服务器（常用Web服务器）

###### **Web服务器**

​	硬件 + 软件

​	软件： 如Apache

​	接受客户端连接 → 接受请求报文 → 处理请求 → 访问Web资源 → 构造应答 → 发送应答

######  	HTTP常见的请求方法

​	GET ： 获取**指定**的服务端资源
​			POST：提交数据到服务端
​			DELETE：删除**指定**的服务端资源
​			UPDATE：更新**指定**的服务端资源

​	**指定**：在地址中指定，在请求数据中指定。
​			例在地址中指定： https://coding.imooc.com/class/**355.html**  或  https://coding.imooc.com/?**sort=0&unlearn=0&page=2**

###### 	HTTP的请求报文和应答报文

![1573500086998](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573500086998.png)

![1573500163388](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573500163388.png)

对于应答报文中的状态码：

![1573500244917](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573500244917.png)



##### 	**HTTPS协议**：

HTTP协议缺点：明文传输，会造成信息泄露。

HTTPS：其中Secure，即为HTTP安全传输协议

格式：https://<主机>：<端口> / <路径>           其中端口变为443

###### 		加密

数据 →秘钥A加密→传输→秘钥B解密→数据

对称加密：加密的秘钥和解密秘钥是一样的
		非对称加密：加密秘钥是不一致的。（A和B是有一定数学关系的**一组**秘钥）

公钥A加密数据后，只能由私钥B解密，而不能用A来解密。

###### 		数字证书

数字证书是可信任组织办法给特定对象的认证。

包含：证书格式、版本号 + 证书序列号 + 签名算法 + 有效期 + 对象名称 + **对线公开秘钥** + ...

###### 		SSL 

SSL：Secure Sockets Layer 安全套接层

SSL是在传输层和应用层之间的。

保证数据安全和数据完整性，对传输层数据进行加密后传输。

###### HTTPS过程

![1573501491663](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573501491663.png)

###### SSL安全参数握手过程

![1573501622163](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573501622163.png)

![1573501777159](C:\Users\ifeng\AppData\Roaming\Typora\typora-user-images\1573501777159.png)